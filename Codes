â€name: ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© (ØªÙ„Ù‚Ø§Ø¦ÙŠ)

â€on:
  # ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„Ù Codes
â€  push:
â€    paths:
â€      - 'Codes'
  
  # ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
â€  schedule:
â€    - cron: '* * * * *'
  
  # ÙŠÙ…ÙƒÙ†Ùƒ ØªØ´ØºÙŠÙ„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹
â€  workflow_dispatch:

â€permissions:
â€  contents: write

â€jobs:
â€  cleanup:
â€    runs-on: ubuntu-latest
    
â€    steps:
â€    - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
â€      uses: actions/checkout@v3
    
â€    - name: ğŸ ØªØ«Ø¨ÙŠØª Python
â€      uses: actions/setup-python@v4
â€      with:
â€        python-version: '3.10'
    
â€    - name: ğŸ” ÙØ­Øµ ÙˆØ­Ø°Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© (ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø°ÙƒÙŠ)
â€      run: |
â€        cat << 'PYTHON_SCRIPT' > cleanup_temp.py
â€        from datetime import datetime, timedelta
â€        import sys
â€        import os
â€        import time
â€        import re
        
â€        def parse_duration(duration_str):
            """ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¯Ø© Ø¥Ù„Ù‰ timedelta"""
â€            duration_str = duration_str.strip().lower()
â€            try:
â€                if duration_str.endswith('s'):
â€                    return timedelta(seconds=int(duration_str[:-1]))
â€                elif duration_str.endswith('m'):
â€                    return timedelta(minutes=int(duration_str[:-1]))
â€                elif duration_str.endswith('h'):
â€                    return timedelta(hours=int(duration_str[:-1]))
â€                elif duration_str.endswith('d'):
â€                    return timedelta(days=int(duration_str[:-1]))
â€            except:
â€                return None
â€            return None
        
â€        print("=" * 70)
â€        print("ğŸ” Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Ù†Ø¸Ø§Ù… Ø°ÙƒÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ)...")
â€        print("=" * 70)
        
        # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù
â€        if not os.path.exists('Codes'):
â€            print("âŒ Ù…Ù„Ù Codes ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!")
â€            sys.exit(1)
        
        # Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù
â€        try:
â€            with open('Codes', 'r', encoding='utf-8') as f:
â€                lines = f.readlines()
â€        except Exception as e:
â€            print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: {e}")
â€            sys.exit(1)
        
â€        now = datetime.utcnow()
â€        print(f"â° Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ (UTC): {now.strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]}")
â€        print()
        
â€        valid_codes = []
â€        deleted_codes = []
â€        pending_codes = []
â€        deleted_count = 0
â€        updated_lines = []
        
        # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: ÙØ­Øµ ÙˆØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯
â€        for line_num, line in enumerate(lines, 1):
â€            original_line = line
â€            line = line.strip()
â€            if not line:
â€                continue
            
â€            try:
â€                parts = line.split('|')
                
                # Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: code|duration (Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®)
â€                if len(parts) == 2:
â€                    code = parts[0].strip()
â€                    duration_str = parts[1].strip()
                    
                    # ØªØ­ÙˆÙŠÙ„ Ù„Ù„ØµÙŠØºØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
â€                    duration = parse_duration(duration_str)
â€                    if duration is None:
â€                        print(f"âš ï¸  Ø³Ø·Ø± {line_num}: Ù…Ø¯Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© - {duration_str}")
â€                        continue
                    
                    # Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
â€                    code_date = now
â€                    full_line = f"{code}|{now.strftime('%Y-%m-%dT%H:%M:%S')}|{duration_str}"
â€                    updated_lines.append((line_num, original_line, full_line))
                    
â€                    print(f"ğŸ†• [{code}] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙ‚ÙŠØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹")
â€                    print(f"   ğŸ“ Ù…Ù†: {line}")
â€                    print(f"   ğŸ“ Ø¥Ù„Ù‰: {full_line}")
                    
                    # Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
â€                    expiry_date = code_date + duration
â€                    time_diff = (expiry_date - now).total_seconds()
                    
â€                    if time_diff > 0:
â€                        valid_codes.append(full_line)
                        
â€                        if time_diff > 86400:
â€                            remaining = f"{int(time_diff // 86400)} ÙŠÙˆÙ…"
â€                        elif time_diff > 3600:
â€                            remaining = f"{int(time_diff // 3600)} Ø³Ø§Ø¹Ø©"
â€                        elif time_diff > 60:
â€                            remaining = f"{int(time_diff // 60)} Ø¯Ù‚ÙŠÙ‚Ø©"
â€                        else:
â€                            remaining = f"{int(time_diff)} Ø«Ø§Ù†ÙŠØ©"
                        
â€                        print(f"   âœ… ØµØ§Ù„Ø­ - Ù…ØªØ¨Ù‚ÙŠ: {remaining}")
                        
â€                        if time_diff <= 120:
â€                            pending_codes.append({
â€                                'code': code,
â€                                'line': full_line,
â€                                'expiry': expiry_date,
â€                                'wait_seconds': time_diff
                            })
â€                            print(f"   â³ Ø³ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ {int(time_diff)} Ø«Ø§Ù†ÙŠØ© - ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±")
                    
â€                    print()
â€                    continue
                
                # Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©: code|date|duration (Ù…Ø¹ ØªØ§Ø±ÙŠØ®)
â€                elif len(parts) == 3:
â€                    code = parts[0].strip()
â€                    date_str = parts[1].strip()
â€                    duration_str = parts[2].strip()
                    
                    # ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
â€                    code_date = datetime.fromisoformat(date_str)
                    
                    # ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø©
â€                    duration = parse_duration(duration_str)
â€                    if duration is None:
â€                        print(f"âš ï¸  Ø³Ø·Ø± {line_num}: Ù…Ø¯Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© - {duration_str}")
â€                        continue
                    
                    # Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
â€                    expiry_date = code_date + duration
â€                    time_diff = (expiry_date - now).total_seconds()
                    
â€                    if time_diff > 0:
â€                        valid_codes.append(line)
                        
â€                        if time_diff > 86400:
â€                            remaining = f"{int(time_diff // 86400)} ÙŠÙˆÙ…"
â€                        elif time_diff > 3600:
â€                            remaining = f"{int(time_diff // 3600)} Ø³Ø§Ø¹Ø©"
â€                        elif time_diff > 60:
â€                            remaining = f"{int(time_diff // 60)} Ø¯Ù‚ÙŠÙ‚Ø©"
â€                        else:
â€                            remaining = f"{int(time_diff)} Ø«Ø§Ù†ÙŠØ©"
                        
â€                        print(f"âœ… [{code}] ØµØ§Ù„Ø­ - Ù…ØªØ¨Ù‚ÙŠ: {remaining}")
                        
â€                        if time_diff <= 120:
â€                            pending_codes.append({
â€                                'code': code,
â€                                'line': line,
â€                                'expiry': expiry_date,
â€                                'wait_seconds': time_diff
                            })
â€                            print(f"   â³ Ø³ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„ {int(time_diff)} Ø«Ø§Ù†ÙŠØ© - ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±")
                    
â€                    else:
â€                        deleted_count += 1
â€                        deleted_codes.append(code)
                        
â€                        time_passed = abs(time_diff)
â€                        if time_passed > 86400:
â€                            passed = f"{int(time_passed // 86400)} ÙŠÙˆÙ…"
â€                        elif time_passed > 3600:
â€                            passed = f"{int(time_passed // 3600)} Ø³Ø§Ø¹Ø©"
â€                        elif time_passed > 60:
â€                            passed = f"{int(time_passed // 60)} Ø¯Ù‚ÙŠÙ‚Ø©"
â€                        else:
â€                            passed = f"{int(time_passed)} Ø«Ø§Ù†ÙŠØ©"
                        
â€                        print(f"ğŸ—‘ï¸  [{code}] Ù…Ù†ØªÙ‡ÙŠ Ù…Ù†Ø° {passed} - Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡")
                
â€                else:
â€                    print(f"âš ï¸  Ø³Ø·Ø± {line_num}: ØµÙŠØºØ© Ø®Ø§Ø·Ø¦Ø© - {line}")
â€                    continue
            
â€            except Exception as e:
â€                print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø³Ø·Ø± {line_num}: {line}")
â€                print(f"   Ø§Ù„ØªÙØ§ØµÙŠÙ„: {str(e)}")
â€                continue
        
â€        print()
â€        print("=" * 70)
        
        # Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
â€        if pending_codes:
â€            print(f"â³ Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ù‚ÙŠÙ‚ Ù„Ù€ {len(pending_codes)} ÙƒÙˆØ¯(Ø£ÙƒÙˆØ§Ø¯) Ù‚Ø±ÙŠØ¨(Ø©) Ù…Ù† Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡...")
â€            print("=" * 70)
            
â€            for item in pending_codes:
â€                if item['wait_seconds'] > 0:
â€                    print(f"â±ï¸  Ø§Ù†ØªØ¸Ø§Ø± {int(item['wait_seconds'])} Ø«Ø§Ù†ÙŠØ© Ù„Ù€ [{item['code']}]...")
â€                    time.sleep(item['wait_seconds'])
                    
â€                    valid_codes.remove(item['line'])
â€                    deleted_codes.append(item['code'])
â€                    deleted_count += 1
                    
â€                    now_after = datetime.utcnow()
â€                    print(f"âœ“ [{item['code']}] ØªÙ… Ø­Ø°ÙÙ‡ ÙÙŠ {now_after.strftime('%H:%M:%S.%f')[:-3]} Ø¨Ø§Ù„Ø¶Ø¨Ø·!")
            
â€            print("=" * 70)
        
        # ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØµØ§Ù„Ø­Ø© ÙÙ‚Ø·
â€        try:
â€            with open('Codes', 'w', encoding='utf-8') as f:
â€                for code in valid_codes:
â€                    f.write(code + '\n')
            
â€            print(f"âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù Codes Ø¨Ù†Ø¬Ø§Ø­")
â€            print(f"ğŸ“Š Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØµØ§Ù„Ø­Ø©: {len(valid_codes)}")
â€            print(f"ğŸ—‘ï¸  Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©: {deleted_count}")
            
â€            if updated_lines:
â€                print(f"ğŸ†• Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ø¯ÙŠØ« ØªÙˆÙ‚ÙŠØªÙ‡Ø§: {len(updated_lines)}")
            
â€            if deleted_count > 0:
â€                print(f"\nğŸ“ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ØªÙ… Ø­Ø°ÙÙ‡Ø§:")
â€                for code in deleted_codes:
â€                    print(f"   â€¢ {code}")
        
â€        except Exception as e:
â€            print(f"âŒ Ø®Ø·Ø£ ÙÙŠ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ù: {e}")
â€            sys.exit(1)
        
â€        print("=" * 70)
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒØªØ§Ø¨Ø©
â€        try:
â€            with open('Codes', 'r', encoding='utf-8') as f:
â€                new_content = f.read()
â€                print(f"\nâœ“ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«:")
â€                print("â”€" * 50)
â€                print(new_content if new_content.strip() else "(Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº - ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯)")
â€                print("â”€" * 50)
â€        except:
â€            pass
        
        # Ø¥Ø±Ø¬Ø§Ø¹ 0 Ø¥Ø°Ø§ ØªÙ… Ø­Ø°Ù Ø£ÙƒÙˆØ§Ø¯ Ø£Ùˆ ØªØ­Ø¯ÙŠØ«
â€        sys.exit(0 if (deleted_count > 0 or updated_lines) else 1)
â€        PYTHON_SCRIPT
        
â€        timeout 600 python cleanup_temp.py
â€        CLEANUP_EXIT_CODE=$?
â€        rm -f cleanup_temp.py
        
â€        echo "CLEANUP_RESULT=$CLEANUP_EXIT_CODE" >> $GITHUB_ENV
    
â€    - name: ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
â€      run: |
â€        git config --local user.email "github-actions[bot]@users.noreply.github.com"
â€        git config --local user.name "ğŸ¤– GitHub Actions Bot"
        
â€        git add Codes
        
â€        if git diff --staged --quiet; then
â€          echo "âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª"
â€        else
â€          echo "ğŸ“ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØºÙŠÙŠØ±Ø§Øª - Ø³ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§..."
          
â€          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
â€          git diff --staged
â€          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
â€          TIMESTAMP=$(date +'%Y-%m-%d %H:%M:%S')
â€          git commit -m "ğŸ—‘ï¸ ØªØ­Ø¯ÙŠØ« ÙˆØ­Ø°Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ [$TIMESTAMP]"
          
â€          echo "â¬†ï¸ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¥Ù„Ù‰ GitHub..."
â€          git push origin main || git push origin master
          
â€          echo "âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!"
â€          echo "ğŸ”— ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„Ù: https://github.com/${{ github.repository }}/blob/main/Codes"
â€        fi
    
â€    - name: â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª
â€      if: env.CLEANUP_RESULT != '0'
â€      run: echo "âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ØµØ§Ù„Ø­Ø© - Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª"
